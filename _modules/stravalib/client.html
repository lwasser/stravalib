
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>stravalib.client &#8212; stravalib 0.6.0 documentation</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../../index.html">
<p class="title">stravalib</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../index.html">
  Home
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../get-started/index.html">
  Get Started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../contributing.html">
  Contribute to Stravalib
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../changelog.html">
  Change Log
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../reference.html">
  API Reference Summary
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <h1>Source code for stravalib.client</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Client</span>
<span class="sd">==============</span>
<span class="sd">Provides the main interface classes for the Strava version 3 REST API.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="c1"># import warnings # unused import</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="kn">import</span> <span class="nn">arrow</span>
<span class="kn">import</span> <span class="nn">pytz</span>
<span class="kn">import</span> <span class="nn">six</span>

<span class="kn">from</span> <span class="nn">units.quantity</span> <span class="kn">import</span> <span class="n">Quantity</span>

<span class="kn">from</span> <span class="nn">stravalib</span> <span class="kn">import</span> <span class="n">model</span><span class="p">,</span> <span class="n">exc</span>
<span class="kn">from</span> <span class="nn">stravalib.protocol</span> <span class="kn">import</span> <span class="n">ApiV3</span>
<span class="kn">from</span> <span class="nn">stravalib.util</span> <span class="kn">import</span> <span class="n">limiter</span>
<span class="kn">from</span> <span class="nn">stravalib</span> <span class="kn">import</span> <span class="n">unithelper</span>


<div class="viewcode-block" id="Client"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.html#stravalib.client.Client">[docs]</a><span class="k">class</span> <span class="nc">Client</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main client class for interacting with the exposed Strava v3 API methods.</span>

<span class="sd">    This class can be instantiated without an access_token when performing authentication;</span>
<span class="sd">    however, most methods will require a valid access token.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Client.__init__"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.html#stravalib.client.Client.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">access_token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">rate_limit_requests</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">rate_limiter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">requests_session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a new client object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        access_token : str</span>
<span class="sd">            The token that provides access to a specific Strava account. If empty, assume that this</span>
<span class="sd">            account is not yet authenticated.</span>
<span class="sd">        rate_limit_requests : bool</span>
<span class="sd">            Whether to apply a rate limiter to the requests. (default True)</span>
<span class="sd">        rate_limiter : callable</span>
<span class="sd">            A :class:`stravalib.util.limiter.RateLimiter` object to use.</span>
<span class="sd">            If not specified (and rate_limit_requests is True), then</span>
<span class="sd">            :class:`stravalib.util.limiter.DefaultRateLimiter` will be used.</span>
<span class="sd">        requests_session : requests.Session() object</span>
<span class="sd">            (Optional) pass request session object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0.__module__}</span><span class="s1">.</span><span class="si">{0.__name__}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">rate_limit_requests</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">rate_limiter</span><span class="p">:</span>
                <span class="n">rate_limiter</span> <span class="o">=</span> <span class="n">limiter</span><span class="o">.</span><span class="n">DefaultRateLimiter</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">rate_limiter</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot specify rate_limiter object when rate_limit_requests is False&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">ApiV3</span><span class="p">(</span><span class="n">access_token</span><span class="o">=</span><span class="n">access_token</span><span class="p">,</span>
                              <span class="n">requests_session</span><span class="o">=</span><span class="n">requests_session</span><span class="p">,</span>
                              <span class="n">rate_limiter</span><span class="o">=</span><span class="n">rate_limiter</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">access_token</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The currently configured authorization token.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">access_token</span>

    <span class="nd">@access_token</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">access_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the currently configured authorization token.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">access_token</span> <span class="o">=</span> <span class="n">v</span>

<div class="viewcode-block" id="Client.authorization_url"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.authorization_url.html#stravalib.client.Client.authorization_url">[docs]</a>    <span class="k">def</span> <span class="nf">authorization_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">client_id</span><span class="p">,</span>
                          <span class="n">redirect_uri</span><span class="p">,</span>
                          <span class="n">approval_prompt</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                          <span class="n">scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the URL needed to authorize your application to access a Strava user&#39;s information.</span>

<span class="sd">        See https://developers.strava.com/docs/authentication/</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        client_id : int</span>
<span class="sd">            The numeric developer client id.</span>
<span class="sd">        redirect_uri : str</span>
<span class="sd">            The URL that Strava will redirect to after successful (or failed) authorization.</span>
<span class="sd">        approval_prompt : str</span>
<span class="sd">            Whether to prompt for approval even if approval already granted to app.</span>
<span class="sd">            Choices are &#39;auto&#39; or &#39;force&#39;.  (Default is &#39;auto&#39;)</span>
<span class="sd">        scope : list[str]</span>
<span class="sd">            The access scope required.  Omit to imply &quot;read&quot; and &quot;activity:read&quot;</span>
<span class="sd">            Valid values are &#39;read&#39;, &#39;read_all&#39;, &#39;profile:read_all&#39;, &#39;profile:write&#39;, &#39;profile:read_all&#39;,</span>
<span class="sd">            &#39;activity:read_all&#39;, &#39;activity:write&#39;.</span>
<span class="sd">        state : str</span>
<span class="sd">            An arbitrary variable that will be returned to your application in the redirect URI.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        string : The URL string to use for authorization link.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">authorization_url</span><span class="p">(</span><span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
                                               <span class="n">redirect_uri</span><span class="o">=</span><span class="n">redirect_uri</span><span class="p">,</span>
                                               <span class="n">approval_prompt</span><span class="o">=</span><span class="n">approval_prompt</span><span class="p">,</span>
                                               <span class="n">scope</span><span class="o">=</span><span class="n">scope</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.exchange_code_for_token"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.exchange_code_for_token.html#stravalib.client.Client.exchange_code_for_token">[docs]</a>    <span class="k">def</span> <span class="nf">exchange_code_for_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exchange the temporary authorization code (returned with redirect from strava authorization URL)</span>
<span class="sd">        for a short-lived access token and a refresh token (used to obtain the next access token later on).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        client_id : int</span>
<span class="sd">            The numeric developer client id.</span>
<span class="sd">        client_secret : str</span>
<span class="sd">            The developer client secret</span>
<span class="sd">        code : str</span>
<span class="sd">            The temporary authorization code</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dictionary containing the access_token, refresh_token</span>
<span class="sd">        and expires_at (number of seconds since Epoch when the provided access token will expire)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">exchange_code_for_token</span><span class="p">(</span><span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
                                                     <span class="n">client_secret</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
                                                     <span class="n">code</span><span class="o">=</span><span class="n">code</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.refresh_access_token"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.refresh_access_token.html#stravalib.client.Client.refresh_access_token">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_access_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">,</span> <span class="n">refresh_token</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exchanges the previous refresh token for a short-lived access token and a new</span>
<span class="sd">        refresh token (used to obtain the next access token later on).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        client_id : int</span>
<span class="sd">            The numeric developer client id.</span>
<span class="sd">        client_secret : str</span>
<span class="sd">            The developer client secret</span>
<span class="sd">        refresh_token : str</span>
<span class="sd">            The refresh token obtained from a previous authorization request</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dictionary containing the access_token, refresh_token</span>
<span class="sd">        and expires_at (number of seconds since Epoch when the provided access token will expire)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">refresh_access_token</span><span class="p">(</span><span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
                                                  <span class="n">client_secret</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
                                                  <span class="n">refresh_token</span><span class="o">=</span><span class="n">refresh_token</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.deauthorize"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.deauthorize.html#stravalib.client.Client.deauthorize">[docs]</a>    <span class="k">def</span> <span class="nf">deauthorize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deauthorize the application. This causes the application to be removed</span>
<span class="sd">        from the athlete&#39;s &quot;My Apps&quot; settings page.</span>

<span class="sd">        https://developers.strava.com/docs/authentication/#deauthorization</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;oauth/deauthorize&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_utc_datetime_to_epoch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activity_datetime</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert the specified datetime value to a unix epoch timestamp (seconds since epoch).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        activity_datetime : str</span>
<span class="sd">            A string which may contain tzinfo (offset) or a datetime object (naive datetime will</span>
<span class="sd">            be considered to be UTC).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Epoch timestamp in int format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">activity_datetime</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">activity_datetime</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">activity_datetime</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">activity_datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">activity_datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">:</span>
            <span class="n">activity_datetime</span> <span class="o">=</span> <span class="n">activity_datetime</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">calendar</span><span class="o">.</span><span class="n">timegm</span><span class="p">(</span><span class="n">activity_datetime</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>

<div class="viewcode-block" id="Client.get_activities"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_activities.html#stravalib.client.Client.get_activities">[docs]</a>    <span class="k">def</span> <span class="nf">get_activities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">before</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get activities for authenticated user sorted by newest first.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Activities-getLoggedInAthleteActivities</span>


<span class="sd">        :param before: Result will start with activities whose start date is</span>
<span class="sd">                       before specified date. (UTC)</span>
<span class="sd">        :type before: datetime.datetime or str or None</span>

<span class="sd">        :param after: Result will start with activities whose start date is after</span>
<span class="sd">                      specified value. (UTC)</span>
<span class="sd">        :type after: datetime.datetime or str or None</span>

<span class="sd">        :param limit: How many maximum activities to return.</span>
<span class="sd">        :type limit: int or None</span>

<span class="sd">        :return: An iterator of :class:`stravalib.model.Activity` objects.</span>
<span class="sd">        :rtype: :class:`BatchedResultsIterator`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">before</span><span class="p">:</span>
            <span class="n">before</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utc_datetime_to_epoch</span><span class="p">(</span><span class="n">before</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">after</span><span class="p">:</span>
            <span class="n">after</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utc_datetime_to_epoch</span><span class="p">(</span><span class="n">after</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">before</span><span class="o">=</span><span class="n">before</span><span class="p">,</span> <span class="n">after</span><span class="o">=</span><span class="n">after</span><span class="p">)</span>
        <span class="n">result_fetcher</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
                                           <span class="s1">&#39;/athlete/activities&#39;</span><span class="p">,</span>
                                           <span class="o">**</span><span class="n">params</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">BatchedResultsIterator</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">Activity</span><span class="p">,</span>
                                      <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="n">result_fetcher</span><span class="o">=</span><span class="n">result_fetcher</span><span class="p">,</span>
                                      <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span></div>


    <span class="c1"># TODO: Doble check these endpoint doc URLs are correct</span>
<div class="viewcode-block" id="Client.get_athlete"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_athlete.html#stravalib.client.Client.get_athlete">[docs]</a>    <span class="k">def</span> <span class="nf">get_athlete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">athlete_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the specified athlete; if athlete_id is None then retrieves a</span>
<span class="sd">        detail-level representation of currently authenticated athlete;</span>
<span class="sd">        otherwise summary-level representation returned of athlete.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Athletes</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Athletes-getLoggedInAthlete</span>

<span class="sd">        :return: The athlete model object.</span>
<span class="sd">        :rtype: :class:`stravalib.model.Athlete`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">athlete_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/athlete&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;The /athletes/</span><span class="si">{id}</span><span class="s2"> endpoint was removed by Strava.  &quot;</span>
                                      <span class="s2">&quot;See https://developers.strava.com/docs/january-2018-update/&quot;</span><span class="p">)</span>

            <span class="c1"># raw = self.protocol.get(&#39;/athletes/{athlete_id}&#39;, athlete_id=athlete_id)</span>

        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">Athlete</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="c1"># TODO: this endpoint was removed so do we want to remove the URL altogether?</span>
<div class="viewcode-block" id="Client.get_athlete_friends"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_athlete_friends.html#stravalib.client.Client.get_athlete_friends">[docs]</a>    <span class="k">def</span> <span class="nf">get_athlete_friends</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">athlete_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets friends for current (or specified) athlete.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-models-DetailedAthlete</span>

<span class="sd">        :param: athlete_id</span>
<span class="sd">        :type: athlete_id: int</span>

<span class="sd">        :param limit: Maximum number of athletes to return (default unlimited).</span>
<span class="sd">        :type limit: int</span>

<span class="sd">        :return: An iterator of :class:`stravalib.model.Athlete` objects.</span>
<span class="sd">        :rtype: :class:`BatchedResultsIterator`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">athlete_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result_fetcher</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="s1">&#39;/athlete/friends&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;The /athletes/</span><span class="si">{id}</span><span class="s2">/friends endpoint was removed by Strava.  &quot;</span>
                                      <span class="s2">&quot;See https://developers.strava.com/docs/january-2018-update/&quot;</span><span class="p">)</span>
            <span class="c1"># result_fetcher = functools.partial(self.protocol.get,</span>
            <span class="c1">#                                    &#39;/athletes/{id}/friends&#39;,</span>
            <span class="c1">#                                    id=athlete_id)</span>

        <span class="k">return</span> <span class="n">BatchedResultsIterator</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">Athlete</span><span class="p">,</span>
                                      <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="n">result_fetcher</span><span class="o">=</span><span class="n">result_fetcher</span><span class="p">,</span>
                                      <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.update_athlete"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.update_athlete.html#stravalib.client.Client.update_athlete">[docs]</a>    <span class="k">def</span> <span class="nf">update_athlete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">city</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">country</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the properties of the authorized athlete.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Athletes-updateLoggedInAthlete</span>

<span class="sd">        :param city: City the athlete lives in</span>
<span class="sd">        :param state: State the athlete lives in</span>
<span class="sd">        :param country: Country the athlete lives in</span>
<span class="sd">        :param sex: Sex of the athlete</span>
<span class="sd">        :param weight: Weight of the athlete in kg (float)</span>

<span class="sd">        :return: The updated athlete</span>
<span class="sd">        :rtype: :class:`stravalib.model.Athlete`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="n">city</span><span class="p">,</span>
                  <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="n">state</span><span class="p">,</span>
                  <span class="s1">&#39;country&#39;</span><span class="p">:</span> <span class="n">country</span><span class="p">,</span>
                  <span class="s1">&#39;sex&#39;</span><span class="p">:</span> <span class="n">sex</span><span class="p">}</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>

        <span class="n">raw_athlete</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;/athlete&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">Athlete</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">raw_athlete</span><span class="p">,</span> <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.get_athlete_followers"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_athlete_followers.html#stravalib.client.Client.get_athlete_followers">[docs]</a>    <span class="k">def</span> <span class="nf">get_athlete_followers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">athlete_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets followers for current (or specified) athlete.</span>

<span class="sd">        :param: athlete_id</span>
<span class="sd">        :type athlete_id: int</span>

<span class="sd">        :param limit: Maximum number of athletes to return (default unlimited).</span>
<span class="sd">        :type limit: int</span>

<span class="sd">        :return: An iterator of :class:`stravalib.model.Athlete` objects.</span>
<span class="sd">        :rtype: :class:`BatchedResultsIterator`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">athlete_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result_fetcher</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="s1">&#39;/athlete/followers&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;The /athletes/</span><span class="si">{id}</span><span class="s2">/followers endpoint was removed by Strava.  &quot;</span>
                                      <span class="s2">&quot;See https://developers.strava.com/docs/january-2018-update/&quot;</span><span class="p">)</span>
            <span class="c1"># result_fetcher = functools.partial(self.protocol.get,</span>
            <span class="c1">#                                    &#39;/athletes/{id}/followers&#39;,</span>
            <span class="c1">#                                    id=athlete_id)</span>

        <span class="k">return</span> <span class="n">BatchedResultsIterator</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">Athlete</span><span class="p">,</span>
                                      <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="n">result_fetcher</span><span class="o">=</span><span class="n">result_fetcher</span><span class="p">,</span>
                                      <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.get_both_following"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_both_following.html#stravalib.client.Client.get_both_following">[docs]</a>    <span class="k">def</span> <span class="nf">get_both_following</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">athlete_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the athletes who both the authenticated user and the indicated</span>
<span class="sd">         athlete are following.</span>

<span class="sd">        This endpoint was removed by Strava in Jan 2018.</span>

<span class="sd">        :param athlete_id: The ID of the other athlete (for follower intersection with current athlete)</span>
<span class="sd">        :type athlete_id: int</span>

<span class="sd">        :param limit: Maximum number of athletes to return. (default unlimited)</span>
<span class="sd">        :type limit: int</span>

<span class="sd">        :return: An iterator of :class:`stravalib.model.Athlete` objects.</span>
<span class="sd">        :rtype: :class:`BatchedResultsIterator`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;The /athletes/</span><span class="si">{id}</span><span class="s2">/both-following endpoint was removed by Strava.  &quot;</span>
                                  <span class="s2">&quot;See https://developers.strava.com/docs/january-2018-update/&quot;</span><span class="p">)</span></div>
        <span class="c1"># result_fetcher = functools.partial(self.protocol.get,</span>
        <span class="c1">#                                    &#39;/athletes/{id}/both-following&#39;,</span>
        <span class="c1">#                                    id=athlete_id)</span>
        <span class="c1">#</span>
        <span class="c1"># return BatchedResultsIterator(entity=model.Athlete,</span>
        <span class="c1">#                               bind_client=self,</span>
        <span class="c1">#                               result_fetcher=result_fetcher,</span>
        <span class="c1">#                               limit=limit)</span>

    <span class="c1"># TODO: Can&#39;t find this in the api documentation either. Does it still work?</span>
<div class="viewcode-block" id="Client.get_athlete_koms"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_athlete_koms.html#stravalib.client.Client.get_athlete_koms">[docs]</a>    <span class="k">def</span> <span class="nf">get_athlete_koms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">athlete_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets Q/KOMs/CRs for specified athlete.</span>

<span class="sd">        KOMs are returned as `stravalib.model.SegmentEffort` objects.</span>

<span class="sd">        :param athlete_id: The ID of the athlete.</span>
<span class="sd">        :type athlete_id: int</span>

<span class="sd">        :param limit: Maximum number of KOM segment efforts to return (default unlimited).</span>
<span class="sd">        :type limit: int</span>

<span class="sd">        :return: An iterator of :class:`stravalib.model.SegmentEffort` objects.</span>
<span class="sd">        :rtype: :class:`BatchedResultsIterator`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result_fetcher</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
                                           <span class="s1">&#39;/athletes/</span><span class="si">{id}</span><span class="s1">/koms&#39;</span><span class="p">,</span>
                                           <span class="nb">id</span><span class="o">=</span><span class="n">athlete_id</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">BatchedResultsIterator</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">SegmentEffort</span><span class="p">,</span>
                                      <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="n">result_fetcher</span><span class="o">=</span><span class="n">result_fetcher</span><span class="p">,</span>
                                      <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.get_athlete_stats"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_athlete_stats.html#stravalib.client.Client.get_athlete_stats">[docs]</a>    <span class="k">def</span> <span class="nf">get_athlete_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">athlete_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns Statistics for the athlete.</span>
<span class="sd">        athlete_id must be the id of the authenticated athlete or left blank.</span>
<span class="sd">        If it is left blank two requests will be made - first to get the</span>
<span class="sd">        authenticated athlete&#39;s id and second to get the Stats.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Athletes-getStats</span>

<span class="sd">        :return: A model containing the Stats</span>
<span class="sd">        :rtype: :py:class:`stravalib.model.AthleteStats`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">athlete_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">athlete_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_athlete</span><span class="p">()</span><span class="o">.</span><span class="n">id</span>

        <span class="n">raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/athletes/</span><span class="si">{id}</span><span class="s1">/stats&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">athlete_id</span><span class="p">)</span>
        <span class="c1"># TODO: Better error handling - this will return a 401 if this athlete</span>
        <span class="c1">#       is not the authenticated athlete.</span>

        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">AthleteStats</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.get_athlete_clubs"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_athlete_clubs.html#stravalib.client.Client.get_athlete_clubs">[docs]</a>    <span class="k">def</span> <span class="nf">get_athlete_clubs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List the clubs for the currently authenticated athlete.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Clubs-getLoggedInAthleteClubs</span>

<span class="sd">        :return: A list of :class:`stravalib.model.Club`</span>
<span class="sd">        :rtype: :py:class:`list`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">club_structs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/athlete/clubs&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">Club</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">raw</span> <span class="ow">in</span> <span class="n">club_structs</span><span class="p">]</span></div>

<div class="viewcode-block" id="Client.join_club"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.join_club.html#stravalib.client.Client.join_club">[docs]</a>    <span class="k">def</span> <span class="nf">join_club</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">club_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Joins the club on behalf of authenticated athlete.</span>

<span class="sd">        (Access token with write permissions required.)</span>

<span class="sd">        :param club_id: The numeric ID of the club to join.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;clubs/</span><span class="si">{id}</span><span class="s1">/join&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">club_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.leave_club"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.leave_club.html#stravalib.client.Client.leave_club">[docs]</a>    <span class="k">def</span> <span class="nf">leave_club</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">club_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Leave club on behalf of authenticated user.</span>

<span class="sd">        (Acces token with write permissions required.)</span>

<span class="sd">        :param club_id:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;clubs/</span><span class="si">{id}</span><span class="s1">/leave&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">club_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.get_club"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_club.html#stravalib.client.Client.get_club">[docs]</a>    <span class="k">def</span> <span class="nf">get_club</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">club_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a specific club object.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Clubs-getClubById</span>

<span class="sd">        :param club_id: The ID of the club to fetch.</span>
<span class="sd">        :type club_id: int</span>

<span class="sd">        :rtype: :class:`stravalib.model.Club`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/clubs/</span><span class="si">{id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">club_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">Club</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.get_club_members"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_club_members.html#stravalib.client.Client.get_club_members">[docs]</a>    <span class="k">def</span> <span class="nf">get_club_members</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">club_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the member objects for specified club ID.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Clubs-getClubMembersById</span>

<span class="sd">        :param club_id: The numeric ID for the club.</span>
<span class="sd">        :type club_id: int</span>

<span class="sd">        :param limit: Maximum number of athletes to return. (default unlimited)</span>
<span class="sd">        :type limit: int</span>

<span class="sd">        :return: An iterator of :class:`stravalib.model.Athlete` objects.</span>
<span class="sd">        :rtype: :class:`BatchedResultsIterator`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result_fetcher</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
                                           <span class="s1">&#39;/clubs/</span><span class="si">{id}</span><span class="s1">/members&#39;</span><span class="p">,</span>
                                           <span class="nb">id</span><span class="o">=</span><span class="n">club_id</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">BatchedResultsIterator</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">Athlete</span><span class="p">,</span> <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="n">result_fetcher</span><span class="o">=</span><span class="n">result_fetcher</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.get_club_activities"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_club_activities.html#stravalib.client.Client.get_club_activities">[docs]</a>    <span class="k">def</span> <span class="nf">get_club_activities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">club_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the activities associated with specified club.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Clubs-getClubActivitiesById</span>

<span class="sd">        :param club_id: The numeric ID for the club.</span>
<span class="sd">        :type club_id: int</span>

<span class="sd">        :param limit: Maximum number of activities to return. (default unlimited)</span>
<span class="sd">        :type limit: int</span>

<span class="sd">        :return: An iterator of :class:`stravalib.model.Activity` objects.</span>
<span class="sd">        :rtype: :class:`BatchedResultsIterator`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result_fetcher</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
                                           <span class="s1">&#39;/clubs/</span><span class="si">{id}</span><span class="s1">/activities&#39;</span><span class="p">,</span>
                                           <span class="nb">id</span><span class="o">=</span><span class="n">club_id</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">BatchedResultsIterator</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">Activity</span><span class="p">,</span> <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="n">result_fetcher</span><span class="o">=</span><span class="n">result_fetcher</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.get_activity"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_activity.html#stravalib.client.Client.get_activity">[docs]</a>    <span class="k">def</span> <span class="nf">get_activity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activity_id</span><span class="p">,</span> <span class="n">include_all_efforts</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets specified activity.</span>

<span class="sd">        Will be detail-level if owned by authenticated user; otherwise summary-level.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Clubs-getClubActivitiesById</span>

<span class="sd">        :param activity_id: The ID of activity to fetch.</span>
<span class="sd">        :type activity_id: int</span>

<span class="sd">        :param include_all_efforts: Whether to include segment efforts - only</span>
<span class="sd">                                    available to the owner of the activty.</span>
<span class="sd">        :type include_all_efforts: bool</span>

<span class="sd">        :rtype: :class:`stravalib.model.Activity`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/activities/</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">activity_id</span><span class="p">,</span>
                                <span class="n">include_all_efforts</span><span class="o">=</span><span class="n">include_all_efforts</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">Activity</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.get_friend_activities"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_friend_activities.html#stravalib.client.Client.get_friend_activities">[docs]</a>    <span class="k">def</span> <span class="nf">get_friend_activities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        DEPRECATED This endpoint was removed by Strava in Jan 2018.</span>

<span class="sd">        :param limit: Maximum number of activities to return. (default unlimited)</span>
<span class="sd">        :type limit: int</span>

<span class="sd">        :return: An iterator of :class:`stravalib.model.Activity` objects.</span>
<span class="sd">        :rtype: :class:`BatchedResultsIterator`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;The /activities/following endpoint was removed by Strava.  &quot;</span>
                                  <span class="s2">&quot;See https://developers.strava.com/docs/january-2018-update/&quot;</span><span class="p">)</span></div>

        <span class="c1"># result_fetcher = functools.partial(self.protocol.get, &#39;/activities/following&#39;)</span>
        <span class="c1">#</span>
        <span class="c1"># return BatchedResultsIterator(entity=model.Activity, bind_client=self,</span>
        <span class="c1">#                               result_fetcher=result_fetcher, limit=limit)</span>

<div class="viewcode-block" id="Client.create_activity"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.create_activity.html#stravalib.client.Client.create_activity">[docs]</a>    <span class="k">def</span> <span class="nf">create_activity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">activity_type</span><span class="p">,</span> <span class="n">start_date_local</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new manual activity.</span>

<span class="sd">        If you would like to create an activity from an uploaded GPS file, see the</span>
<span class="sd">        :meth:`stravalib.client.Client.upload_activity` method instead.</span>

<span class="sd">        :param name: The name of the activity.</span>
<span class="sd">        :type name: str</span>

<span class="sd">        :param activity_type: The activity type (case-insensitive).</span>
<span class="sd">                              Possible values: ride, run, swim, workout, hike, walk, nordicski,</span>
<span class="sd">                              alpineski, backcountryski, iceskate, inlineskate, kitesurf, rollerski,</span>
<span class="sd">                              windsurf, workout, snowboard, snowshoe</span>
<span class="sd">        :type activity_type: str</span>

<span class="sd">        :param start_date_local: Local date/time of activity start. (TZ info will be ignored)</span>
<span class="sd">        :type start_date_local: :class:`datetime.datetime` or string in ISO8601 format.</span>

<span class="sd">        :param elapsed_time: The time in seconds or a :class:`datetime.timedelta` object.</span>
<span class="sd">        :type elapsed_time: :class:`datetime.timedelta` or int (seconds)</span>

<span class="sd">        :param description: The description for the activity.</span>
<span class="sd">        :type description: str</span>

<span class="sd">        :param distance: The distance in meters (float) or a :class:`units.quantity.Quantity` instance.</span>
<span class="sd">        :type distance: :class:`units.quantity.Quantity` or float (meters)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">elapsed_time</span><span class="p">,</span> <span class="n">timedelta</span><span class="p">):</span>
            <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">unithelper</span><span class="o">.</span><span class="n">timedelta_to_seconds</span><span class="p">(</span><span class="n">elapsed_time</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">):</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">unithelper</span><span class="o">.</span><span class="n">meters</span><span class="p">(</span><span class="n">distance</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_date_local</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
            <span class="n">start_date_local</span> <span class="o">=</span> <span class="n">start_date_local</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">activity_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">Activity</span><span class="o">.</span><span class="n">TYPES</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid activity type: </span><span class="si">{0}</span><span class="s2">.  Possible values: </span><span class="si">{1!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">activity_type</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Activity</span><span class="o">.</span><span class="n">TYPES</span><span class="p">))</span>

        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">activity_type</span><span class="p">,</span> <span class="n">start_date_local</span><span class="o">=</span><span class="n">start_date_local</span><span class="p">,</span>
                      <span class="n">elapsed_time</span><span class="o">=</span><span class="n">elapsed_time</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">description</span>

        <span class="k">if</span> <span class="n">distance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance</span>

        <span class="n">raw_activity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/activities&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">Activity</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">raw_activity</span><span class="p">,</span> <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.update_activity"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.update_activity.html#stravalib.client.Client.update_activity">[docs]</a>    <span class="k">def</span> <span class="nf">update_activity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activity_id</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">activity_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">private</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">commute</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trainer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gear_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">device_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the properties of a specific activity.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Activities-updateActivityById</span>

<span class="sd">        :param activity_id: The ID of the activity to update.</span>
<span class="sd">        :type activity_id: int</span>

<span class="sd">        :param name: The name of the activity.</span>
<span class="sd">        :param activity_type: The activity type (case-insensitive).</span>
<span class="sd">                              Possible values: ride, run, swim, workout, hike,</span>
<span class="sd">                              walk, nordicski, alpineski, backcountryski,</span>
<span class="sd">                              iceskate, inlineskate, kitesurf, rollerski,</span>
<span class="sd">                              windsurf, workout, snowboard, snowshoe</span>
<span class="sd">        :param private: Whether the activity is private.</span>
<span class="sd">        :param commute: Whether the activity is a commute.</span>
<span class="sd">        :param trainer: Whether this is a trainer activity.</span>
<span class="sd">        :param gear_id: Alpha-numeric ID of gear (bike, shoes) used on this activity.</span>
<span class="sd">        :param description: Description for the activity.</span>
<span class="sd">        :param device_name: Device name for the activity</span>

<span class="sd">        :return: The updated activity.</span>
<span class="sd">        :rtype: :class:`stravalib.model.Activity`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Convert the kwargs into a params dict</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

        <span class="k">if</span> <span class="n">activity_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">activity_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">Activity</span><span class="o">.</span><span class="n">TYPES</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid activity type: </span><span class="si">{0}</span><span class="s2">.  Possible values: </span><span class="si">{1!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">activity_type</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Activity</span><span class="o">.</span><span class="n">TYPES</span><span class="p">))</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">activity_type</span>

        <span class="k">if</span> <span class="n">private</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;private&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">private</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">commute</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;commute&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">commute</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">trainer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;trainer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">trainer</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">gear_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;gear_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gear_id</span>

        <span class="k">if</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">description</span>

        <span class="k">if</span> <span class="n">device_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_name</span>

        <span class="n">raw_activity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;/activities/</span><span class="si">{activity_id}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">activity_id</span><span class="o">=</span><span class="n">activity_id</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">Activity</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">raw_activity</span><span class="p">,</span> <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.upload_activity"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.upload_activity.html#stravalib.client.Client.upload_activity">[docs]</a>    <span class="k">def</span> <span class="nf">upload_activity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activity_file</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">activity_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">private</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">external_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uploads a GPS file (tcx, gpx) to create a new activity for current athlete.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Uploads-createUpload</span>

<span class="sd">        :param activity_file: The file object to upload or file contents.</span>
<span class="sd">        :type activity_file: file or str</span>

<span class="sd">        :param data_type: File format for upload. Possible values: fit, fit.gz, tcx, tcx.gz, gpx, gpx.gz</span>
<span class="sd">        :type data_type: str</span>

<span class="sd">        :param name: (optional) if not provided, will be populated using start date and location, if available</span>
<span class="sd">        :type name: str</span>

<span class="sd">        :param description: (optional) The description for the activity</span>
<span class="sd">        :type name: str</span>

<span class="sd">        :param activity_type: (optional) case-insensitive type of activity.</span>
<span class="sd">                              possible values: ride, run, swim, workout, hike, walk,</span>
<span class="sd">                              nordicski, alpineski, backcountryski, iceskate, inlineskate,</span>
<span class="sd">                              kitesurf, rollerski, windsurf, workout, snowboard, snowshoe</span>
<span class="sd">                              Type detected from file overrides, uses athlete&#39;s default type if not specified</span>
<span class="sd">        :type activity_type: str</span>

<span class="sd">        :param private: (optional) set to True to mark the resulting activity as private, &#39;view_private&#39; permissions will be necessary to view the activity</span>
<span class="sd">        :type private: bool</span>

<span class="sd">        :param external_id: (optional) An arbitrary unique identifier may be specified which will be included in status responses.</span>
<span class="sd">        :type external_id: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">activity_file</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">activity_file</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
                <span class="n">activity_file</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">activity_file</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">activity_file</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">activity_file</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">activity_file</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Invalid type specified for activity_file: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">activity_file</span><span class="p">)))</span>

        <span class="n">valid_data_types</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;fit&#39;</span><span class="p">,</span> <span class="s1">&#39;fit.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;tcx&#39;</span><span class="p">,</span> <span class="s1">&#39;tcx.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;gpx&#39;</span><span class="p">,</span> <span class="s1">&#39;gpx.gz&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data_type</span> <span class="ow">in</span> <span class="n">valid_data_types</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid data type </span><span class="si">{0}</span><span class="s2">. Possible values </span><span class="si">{1!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="n">valid_data_types</span><span class="p">))</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data_type&#39;</span><span class="p">:</span> <span class="n">data_type</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">description</span>
        <span class="k">if</span> <span class="n">activity_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">activity_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">Activity</span><span class="o">.</span><span class="n">TYPES</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid activity type: </span><span class="si">{0}</span><span class="s2">.  Possible values: </span><span class="si">{1!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">activity_type</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Activity</span><span class="o">.</span><span class="n">TYPES</span><span class="p">))</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;activity_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">activity_type</span>
        <span class="k">if</span> <span class="n">private</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;private&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">private</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">external_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;external_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">external_id</span>

        <span class="n">initial_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/uploads&#39;</span><span class="p">,</span>
                                              <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">activity_file</span><span class="p">},</span>
                                              <span class="n">check_for_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                              <span class="o">**</span><span class="n">params</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ActivityUploader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="n">initial_response</span><span class="p">)</span></div>

    <span class="c1"># TODO: I don&#39;t think this is the correct link but can&#39;t find it in the docs</span>
<div class="viewcode-block" id="Client.delete_activity"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.delete_activity.html#stravalib.client.Client.delete_activity">[docs]</a>    <span class="k">def</span> <span class="nf">delete_activity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activity_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes the specified activity.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Activities</span>

<span class="sd">        :param activity_id: The activity to delete.</span>
<span class="sd">        :type activity_id: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;/activities/</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">activity_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.get_activity_zones"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_activity_zones.html#stravalib.client.Client.get_activity_zones">[docs]</a>    <span class="k">def</span> <span class="nf">get_activity_zones</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activity_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets zones for activity.</span>

<span class="sd">        Requires premium account.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Activities-getZonesByActivityId</span>

<span class="sd">        :param activity_id: The activity for which to zones.</span>
<span class="sd">        :type activity_id: int</span>

<span class="sd">        :return: An list of :class:`stravalib.model.ActivityComment` objects.</span>
<span class="sd">        :rtype: :py:class:`list`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">zones</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/activities/</span><span class="si">{id}</span><span class="s1">/zones&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">activity_id</span><span class="p">)</span>
        <span class="c1"># We use a factory to give us the correct zone based on type.</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">BaseActivityZone</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">zones</span><span class="p">]</span></div>

<div class="viewcode-block" id="Client.get_activity_comments"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_activity_comments.html#stravalib.client.Client.get_activity_comments">[docs]</a>    <span class="k">def</span> <span class="nf">get_activity_comments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activity_id</span><span class="p">,</span> <span class="n">markdown</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the comments for an activity.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Activities-getCommentsByActivityId</span>

<span class="sd">        :param activity_id: The activity for which to fetch comments.</span>
<span class="sd">        :type activity_id: int</span>

<span class="sd">        :param markdown: Whether to include markdown in comments (default is false/filterout).</span>
<span class="sd">        :type markdown: bool</span>

<span class="sd">        :param limit: Max rows to return (default unlimited).</span>
<span class="sd">        :type limit: int</span>

<span class="sd">        :return: An iterator of :class:`stravalib.model.ActivityComment` objects.</span>
<span class="sd">        :rtype: :class:`BatchedResultsIterator`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result_fetcher</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="s1">&#39;/activities/</span><span class="si">{id}</span><span class="s1">/comments&#39;</span><span class="p">,</span>
                                           <span class="nb">id</span><span class="o">=</span><span class="n">activity_id</span><span class="p">,</span> <span class="n">markdown</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">markdown</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">BatchedResultsIterator</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">ActivityComment</span><span class="p">,</span>
                                      <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="n">result_fetcher</span><span class="o">=</span><span class="n">result_fetcher</span><span class="p">,</span>
                                      <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.get_activity_kudos"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_activity_kudos.html#stravalib.client.Client.get_activity_kudos">[docs]</a>    <span class="k">def</span> <span class="nf">get_activity_kudos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activity_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the kudos for an activity.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Activities-getKudoersByActivityId</span>

<span class="sd">        :param activity_id: The activity for which to fetch kudos.</span>
<span class="sd">        :type activity_id: int</span>

<span class="sd">        :param limit: Max rows to return (default unlimited).</span>
<span class="sd">        :type limit: int</span>

<span class="sd">        :return: An iterator of :class:`stravalib.model.ActivityKudos` objects.</span>
<span class="sd">        :rtype: :class:`BatchedResultsIterator`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result_fetcher</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
                                           <span class="s1">&#39;/activities/</span><span class="si">{id}</span><span class="s1">/kudos&#39;</span><span class="p">,</span>
                                           <span class="nb">id</span><span class="o">=</span><span class="n">activity_id</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">BatchedResultsIterator</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">ActivityKudos</span><span class="p">,</span>
                                      <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="n">result_fetcher</span><span class="o">=</span><span class="n">result_fetcher</span><span class="p">,</span>
                                      <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span></div>

    <span class="c1"># TODO not sure this is the correct api doc link - couldn&#39;t find &quot;photos&quot;</span>
<div class="viewcode-block" id="Client.get_activity_photos"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_activity_photos.html#stravalib.client.Client.get_activity_photos">[docs]</a>    <span class="k">def</span> <span class="nf">get_activity_photos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activity_id</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">only_instagram</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the photos from an activity.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Activities</span>

<span class="sd">        :param activity_id: The activity for which to fetch photos.</span>
<span class="sd">        :type activity_id: int</span>

<span class="sd">        :param size: the requested size of the activity&#39;s photos. URLs for the photos will be returned that best match</span>
<span class="sd">                    the requested size. If not included, the smallest size is returned</span>
<span class="sd">        :type size: int</span>

<span class="sd">        :param only_instagram: Parameter to preserve legacy behavior of only returning Instagram photos.</span>
<span class="sd">        :type only_instagram: bool</span>

<span class="sd">        :return: An iterator of :class:`stravalib.model.ActivityPhoto` objects.</span>
<span class="sd">        :rtype: :class:`BatchedResultsIterator`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">only_instagram</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;photo_sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span>

        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span>

        <span class="n">result_fetcher</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
                                           <span class="s1">&#39;/activities/</span><span class="si">{id}</span><span class="s1">/photos&#39;</span><span class="p">,</span>
                                           <span class="nb">id</span><span class="o">=</span><span class="n">activity_id</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">BatchedResultsIterator</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">ActivityPhoto</span><span class="p">,</span>
                                      <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="n">result_fetcher</span><span class="o">=</span><span class="n">result_fetcher</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.get_activity_laps"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_activity_laps.html#stravalib.client.Client.get_activity_laps">[docs]</a>    <span class="k">def</span> <span class="nf">get_activity_laps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activity_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the laps from an activity.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Activities-getLapsByActivityId</span>

<span class="sd">        :param activity_id: The activity for which to fetch laps.</span>
<span class="sd">        :type activity_id: int</span>

<span class="sd">        :return: An iterator of :class:`stravalib.model.ActivityLaps` objects.</span>
<span class="sd">        :rtype: :class:`BatchedResultsIterator`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result_fetcher</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
                                           <span class="s1">&#39;/activities/</span><span class="si">{id}</span><span class="s1">/laps&#39;</span><span class="p">,</span>
                                           <span class="nb">id</span><span class="o">=</span><span class="n">activity_id</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">BatchedResultsIterator</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">ActivityLap</span><span class="p">,</span>
                                      <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="n">result_fetcher</span><span class="o">=</span><span class="n">result_fetcher</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.get_related_activities"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_related_activities.html#stravalib.client.Client.get_related_activities">[docs]</a>    <span class="k">def</span> <span class="nf">get_related_activities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activity_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deprecated. This endpoint was removed by strava in Jan 2018.</span>

<span class="sd">        :param activity_id: The activity for which to fetch related activities.</span>
<span class="sd">        :type activity_id: int</span>

<span class="sd">        :return: An iterator of :class:`stravalib.model.Activity` objects.</span>
<span class="sd">        :rtype: :class:`BatchedResultsIterator`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;The /activities/</span><span class="si">{id}</span><span class="s2">/related endpoint was removed by Strava.  &quot;</span>
                                  <span class="s2">&quot;See https://developers.strava.com/docs/january-2018-update/&quot;</span><span class="p">)</span></div>

        <span class="c1"># result_fetcher = functools.partial(self.protocol.get,</span>
        <span class="c1">#                                    &#39;/activities/{id}/related&#39;,</span>
        <span class="c1">#                                    id=activity_id)</span>
        <span class="c1">#</span>
        <span class="c1"># return BatchedResultsIterator(entity=model.Activity,</span>
        <span class="c1">#                               bind_client=self,</span>
        <span class="c1">#                               result_fetcher=result_fetcher,</span>
        <span class="c1">#                               limit=limit)</span>

<div class="viewcode-block" id="Client.get_gear"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_gear.html#stravalib.client.Client.get_gear">[docs]</a>    <span class="k">def</span> <span class="nf">get_gear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gear_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get details for an item of gear.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Gears</span>

<span class="sd">        :param gear_id: The gear id.</span>
<span class="sd">        :type gear_id: str</span>

<span class="sd">        :return: The Bike or Shoe subclass object.</span>
<span class="sd">        :rtype: :class:`stravalib.model.Gear`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">Gear</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/gear/</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">gear_id</span><span class="p">))</span></div>

<div class="viewcode-block" id="Client.get_segment_effort"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_segment_effort.html#stravalib.client.Client.get_segment_effort">[docs]</a>    <span class="k">def</span> <span class="nf">get_segment_effort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">effort_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a specific segment effort by ID.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-SegmentEfforts</span>

<span class="sd">        :param effort_id: The id of associated effort to fetch.</span>
<span class="sd">        :type effort_id: int</span>

<span class="sd">        :return: The specified effort on a segment.</span>
<span class="sd">        :rtype: :class:`stravalib.model.SegmentEffort`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">SegmentEffort</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/segment_efforts/</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="p">,</span>
                                                                 <span class="nb">id</span><span class="o">=</span><span class="n">effort_id</span><span class="p">))</span></div>

<div class="viewcode-block" id="Client.get_segment"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_segment.html#stravalib.client.Client.get_segment">[docs]</a>    <span class="k">def</span> <span class="nf">get_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">segment_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets a specific segment by ID.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-SegmentEfforts-getSegmentEffortById</span>

<span class="sd">        :param segment_id: The segment to fetch.</span>
<span class="sd">        :type segment_id: int</span>

<span class="sd">        :return: A segment object.</span>
<span class="sd">        :rtype: :class:`stravalib.model.Segment`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">Segment</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/segments/</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="p">,</span>
                                         <span class="nb">id</span><span class="o">=</span><span class="n">segment_id</span><span class="p">),</span> <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.get_starred_segments"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_starred_segments.html#stravalib.client.Client.get_starred_segments">[docs]</a>    <span class="k">def</span> <span class="nf">get_starred_segments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a summary representation of the segments starred by the</span>
<span class="sd">         authenticated user. Pagination is supported.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Segments-getLoggedInAthleteStarredSegments</span>

<span class="sd">        :param limit: (optional), limit number of starred segments returned.</span>
<span class="sd">        :type limit: int</span>

<span class="sd">        :return: An iterator of :class:`stravalib.model.Segment` starred by authenticated user.</span>
<span class="sd">        :rtype: :class:`BatchedResultsIterator`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;limit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">limit</span>

        <span class="n">result_fetcher</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
                                           <span class="s1">&#39;/segments/starred&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">BatchedResultsIterator</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">Segment</span><span class="p">,</span>
                                      <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="n">result_fetcher</span><span class="o">=</span><span class="n">result_fetcher</span><span class="p">,</span>
                                      <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span></div>

    <span class="c1"># TODO: i&#39;m not sure what the diff is between this method and the one above</span>
    <span class="c1"># So i used the SAME API doc link for both. may need to revisit</span>
<div class="viewcode-block" id="Client.get_athlete_starred_segments"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_athlete_starred_segments.html#stravalib.client.Client.get_athlete_starred_segments">[docs]</a>    <span class="k">def</span> <span class="nf">get_athlete_starred_segments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">athlete_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a summary representation of the segments starred by the</span>
<span class="sd">         specified athlete. Pagination is supported.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Segments-getLoggedInAthleteStarredSegments</span>

<span class="sd">        :param athlete_id: The ID of the athlete.</span>
<span class="sd">        :type athlete_id: int</span>

<span class="sd">        :param limit: (optional), limit number of starred segments returned.</span>
<span class="sd">        :type limit: int</span>

<span class="sd">        :return: An iterator of :class:`stravalib.model.Segment` starred by authenticated user.</span>
<span class="sd">        :rtype: :class:`BatchedResultsIterator`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result_fetcher</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
                                           <span class="s1">&#39;/athletes/</span><span class="si">{id}</span><span class="s1">/segments/starred&#39;</span><span class="p">,</span>
                                           <span class="nb">id</span><span class="o">=</span><span class="n">athlete_id</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">BatchedResultsIterator</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">Segment</span><span class="p">,</span>
                                      <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="n">result_fetcher</span><span class="o">=</span><span class="n">result_fetcher</span><span class="p">,</span>
                                      <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span></div>

    <span class="c1"># TODO find the new equavilent link in the strava docs</span>
<div class="viewcode-block" id="Client.get_segment_leaderboard"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_segment_leaderboard.html#stravalib.client.Client.get_segment_leaderboard">[docs]</a>    <span class="k">def</span> <span class="nf">get_segment_leaderboard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">segment_id</span><span class="p">,</span> <span class="n">gender</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">age_group</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weight_class</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">following</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">club_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeframe</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top_results_limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">page</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context_entries</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the leaderboard for a segment.</span>

<span class="sd">        Note that by default Strava will return the top 10 results, and if the current user has ridden</span>
<span class="sd">        that segment, the current user&#39;s result along with the two results above in rank and the two</span>
<span class="sd">        results below will be included.  The top X results can be configured by setting the top_results_limit</span>
<span class="sd">        parameter; however, the other 5 results will be included if the current user has ridden that segment.</span>
<span class="sd">        (i.e. if you specify top_results_limit=15, you will get a total of 20 entries back.)</span>

<span class="sd">        :param segment_id: ID of the segment.</span>
<span class="sd">        :type segment_id: int</span>

<span class="sd">        :param gender: (optional) &#39;M&#39; or &#39;F&#39;</span>
<span class="sd">        :type gender: str</span>

<span class="sd">        :param age_group: (optional) &#39;0_24&#39;, &#39;25_34&#39;, &#39;35_44&#39;, &#39;45_54&#39;, &#39;55_64&#39;, &#39;65_plus&#39;</span>
<span class="sd">        :type age_group: str</span>

<span class="sd">        :param weight_class: (optional) pounds &#39;0_124&#39;, &#39;125_149&#39;, &#39;150_164&#39;, &#39;165_179&#39;, &#39;180_199&#39;, &#39;200_plus&#39;</span>
<span class="sd">                             or kilograms &#39;0_54&#39;, &#39;55_64&#39;, &#39;65_74&#39;, &#39;75_84&#39;, &#39;85_94&#39;, &#39;95_plus&#39;</span>
<span class="sd">        :type weight_class: str</span>

<span class="sd">        :param following: (optional) Limit to athletes current user is following.</span>
<span class="sd">        :type following: bool</span>

<span class="sd">        :param club_id: (optional) limit to specific club</span>
<span class="sd">        :type club_id: int</span>

<span class="sd">        :param timeframe: (optional)  &#39;this_year&#39;, &#39;this_month&#39;, &#39;this_week&#39;, &#39;today&#39;</span>
<span class="sd">        :type timeframe: str</span>

<span class="sd">        :param top_results_limit: (optional, strava default is 10 + 5 from end) How many of leading leaderboard entries to display.</span>
<span class="sd">                            See description for why this is a little confusing.</span>
<span class="sd">        :type top_results_limit: int</span>

<span class="sd">        :param page: (optional, strava default is 1) Page number of leaderboard to return, sorted by highest ranking leaders</span>
<span class="sd">        :type page: int</span>

<span class="sd">        :param context_entries: (optional, strava default is 2, max is 15) number of entries surrounding requesting athlete to return</span>
<span class="sd">        :type context_entries: int</span>

<span class="sd">        :return: The SegmentLeaderboard for the specified page (default: 1)</span>
<span class="sd">        :rtype: :class:`stravalib.model.SegmentLeaderboard`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">gender</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">gender</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid gender: </span><span class="si">{0}</span><span class="s2">. Possible values: &#39;M&#39; or &#39;F&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gender</span><span class="p">))</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gender</span>

        <span class="n">valid_age_groups</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;0_24&#39;</span><span class="p">,</span> <span class="s1">&#39;25_34&#39;</span><span class="p">,</span> <span class="s1">&#39;35_44&#39;</span><span class="p">,</span> <span class="s1">&#39;45_54&#39;</span><span class="p">,</span> <span class="s1">&#39;55_64&#39;</span><span class="p">,</span> <span class="s1">&#39;65_plus&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">age_group</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">age_group</span> <span class="ow">in</span> <span class="n">valid_age_groups</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid age group: </span><span class="si">{0}</span><span class="s2">.  Possible values: </span><span class="si">{1!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">age_group</span><span class="p">,</span> <span class="n">valid_age_groups</span><span class="p">))</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;age_group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">age_group</span>

        <span class="n">valid_weight_classes</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;0_124&#39;</span><span class="p">,</span> <span class="s1">&#39;125_149&#39;</span><span class="p">,</span> <span class="s1">&#39;150_164&#39;</span><span class="p">,</span> <span class="s1">&#39;165_179&#39;</span><span class="p">,</span> <span class="s1">&#39;180_199&#39;</span><span class="p">,</span> <span class="s1">&#39;200_plus&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;0_54&#39;</span><span class="p">,</span> <span class="s1">&#39;55_64&#39;</span><span class="p">,</span> <span class="s1">&#39;65_74&#39;</span><span class="p">,</span> <span class="s1">&#39;75_84&#39;</span><span class="p">,</span> <span class="s1">&#39;85_94&#39;</span><span class="p">,</span> <span class="s1">&#39;95_plus&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">weight_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">weight_class</span> <span class="ow">in</span> <span class="n">valid_weight_classes</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid weight class: </span><span class="si">{0}</span><span class="s2">.  Possible values: </span><span class="si">{1!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weight_class</span><span class="p">,</span> <span class="n">valid_weight_classes</span><span class="p">))</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;weight_class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight_class</span>

        <span class="k">if</span> <span class="n">following</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;following&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">following</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">club_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;club_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">club_id</span>

        <span class="k">if</span> <span class="n">timeframe</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">valid_timeframes</span> <span class="o">=</span> <span class="s1">&#39;this_year&#39;</span><span class="p">,</span> <span class="s1">&#39;this_month&#39;</span><span class="p">,</span> <span class="s1">&#39;this_week&#39;</span><span class="p">,</span> <span class="s1">&#39;today&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">timeframe</span> <span class="ow">in</span> <span class="n">valid_timeframes</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid timeframe: </span><span class="si">{0}</span><span class="s2">.  Possible values: </span><span class="si">{1!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timeframe</span><span class="p">,</span> <span class="n">valid_timeframes</span><span class="p">))</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;date_range&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timeframe</span>

        <span class="k">if</span> <span class="n">top_results_limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;per_page&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_results_limit</span>

        <span class="k">if</span> <span class="n">page</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;page&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>

        <span class="k">if</span> <span class="n">context_entries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;context_entries&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context_entries</span>

        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">SegmentLeaderboard</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/segments/</span><span class="si">{id}</span><span class="s1">/leaderboard&#39;</span><span class="p">,</span>
                                                                      <span class="nb">id</span><span class="o">=</span><span class="n">segment_id</span><span class="p">,</span>
                                                                      <span class="o">**</span><span class="n">params</span><span class="p">),</span>
                                                    <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.get_segment_efforts"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_segment_efforts.html#stravalib.client.Client.get_segment_efforts">[docs]</a>    <span class="k">def</span> <span class="nf">get_segment_efforts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">segment_id</span><span class="p">,</span> <span class="n">athlete_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">start_date_local</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date_local</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets all efforts on a particular segment sorted by start_date_local</span>

<span class="sd">        Returns an array of segment effort summary representations sorted by</span>
<span class="sd">        start_date_local ascending or by elapsed_time if an athlete_id is</span>
<span class="sd">        provided.</span>

<span class="sd">        If no filtering parameters is provided all efforts for the segment</span>
<span class="sd">        will be returned.</span>

<span class="sd">        Date range filtering is accomplished using an inclusive start and end time,</span>
<span class="sd">        thus start_date_local and end_date_local must be sent together. For open</span>
<span class="sd">        ended ranges pick dates significantly in the past or future. The</span>
<span class="sd">        filtering is done over local time for the segment, so there is no need</span>
<span class="sd">        for timezone conversion. For example, all efforts on Jan. 1st, 2014</span>
<span class="sd">        for a segment in San Francisco, CA can be fetched using</span>
<span class="sd">        2014-01-01T00:00:00Z and 2014-01-01T23:59:59Z.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-SegmentEfforts-getEffortsBySegmentId</span>

<span class="sd">        :param segment_id: ID of the segment.</span>
<span class="sd">        :type segment_id: param</span>

<span class="sd">        :int athlete_id: (optional) ID of athlete.</span>
<span class="sd">        :type athlete_id: int</span>

<span class="sd">        :param start_date_local: (optional) efforts before this date will be excluded.</span>
<span class="sd">                                            Either as ISO8601 or datetime object</span>
<span class="sd">        :type start_date_local: datetime.datetime or str</span>

<span class="sd">        :param end_date_local: (optional) efforts after this date will be excluded.</span>
<span class="sd">                                           Either as ISO8601 or datetime object</span>
<span class="sd">        :type end_date_local: datetime.datetime or str</span>

<span class="sd">        :param limit: (optional), limit number of efforts.</span>
<span class="sd">        :type limit: int</span>

<span class="sd">        :return: An iterator of :class:`stravalib.model.SegmentEffort` efforts on a segment.</span>
<span class="sd">        :rtype: :class:`BatchedResultsIterator`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;segment_id&quot;</span><span class="p">:</span> <span class="n">segment_id</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">athlete_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;athlete_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">athlete_id</span>

        <span class="k">if</span> <span class="n">start_date_local</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_date_local</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
                <span class="n">start_date_local</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">start_date_local</span><span class="p">)</span><span class="o">.</span><span class="n">naive</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;start_date_local&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_date_local</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">end_date_local</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end_date_local</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
                <span class="n">end_date_local</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">end_date_local</span><span class="p">)</span><span class="o">.</span><span class="n">naive</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;end_date_local&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_date_local</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;limit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">limit</span>

        <span class="n">result_fetcher</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
                                           <span class="s1">&#39;/segments/</span><span class="si">{segment_id}</span><span class="s1">/all_efforts&#39;</span><span class="p">,</span>
                                           <span class="o">**</span><span class="n">params</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">BatchedResultsIterator</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">BaseEffort</span><span class="p">,</span> <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="n">result_fetcher</span><span class="o">=</span><span class="n">result_fetcher</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.explore_segments"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.explore_segments.html#stravalib.client.Client.explore_segments">[docs]</a>    <span class="k">def</span> <span class="nf">explore_segments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">activity_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_cat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_cat</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an array of up to 10 segments.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Segments-exploreSegments</span>

<span class="sd">        :param bounds: list of bounding box corners lat/lon [sw.lat, sw.lng, ne.lat, ne.lng] (south,west,north,east)</span>
<span class="sd">        :type bounds: list of 4 floats or list of 2 (lat,lon) tuples</span>

<span class="sd">        :param activity_type: (optional, default is riding)  &#39;running&#39; or &#39;riding&#39;</span>
<span class="sd">        :type activity_type: str</span>

<span class="sd">        :param min_cat: (optional) Minimum climb category filter</span>
<span class="sd">        :type min_cat: int</span>

<span class="sd">        :param max_cat: (optional) Maximum climb category filter</span>
<span class="sd">        :type max_cat: int</span>

<span class="sd">        :return: An list of :class:`stravalib.model.Segment`.</span>
<span class="sd">        :rtype: :py:class:`list`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid bounds specified: </span><span class="si">{0!r}</span><span class="s2">. Must be list of 4 float values or list of 2 (lat,lon) tuples.&quot;</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bounds</span><span class="p">)}</span>

        <span class="n">valid_activity_types</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;riding&#39;</span><span class="p">,</span> <span class="s1">&#39;running&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">activity_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">activity_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;riding&#39;</span><span class="p">,</span> <span class="s1">&#39;running&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid activity type: </span><span class="si">{0}</span><span class="s1">.  Possible values: </span><span class="si">{1!r}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">activity_type</span><span class="p">,</span> <span class="n">valid_activity_types</span><span class="p">))</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;activity_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">activity_type</span>

        <span class="k">if</span> <span class="n">min_cat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;min_cat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_cat</span>
        <span class="k">if</span> <span class="n">max_cat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s1">&#39;max_cat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_cat</span>

        <span class="n">raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/segments/explore&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">SegmentExplorerResult</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">raw</span><span class="p">[</span><span class="s1">&#39;segments&#39;</span><span class="p">]]</span></div>

<div class="viewcode-block" id="Client.get_activity_streams"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_activity_streams.html#stravalib.client.Client.get_activity_streams">[docs]</a>    <span class="k">def</span> <span class="nf">get_activity_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activity_id</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">series_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a stream for an activity.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Streams-getActivityStreams</span>

<span class="sd">        Streams represent the raw spatial data for the uploaded file. External</span>
<span class="sd">        applications may only access this information for activities owned</span>
<span class="sd">        by the authenticated athlete.</span>

<span class="sd">        Streams are available in 11 different types. If the stream is not</span>
<span class="sd">        available for a particular activity it will be left out of the request</span>
<span class="sd">        results.</span>

<span class="sd">        Streams types are: time, latlng, distance, altitude, velocity_smooth,</span>
<span class="sd">                           heartrate, cadence, watts, temp, moving, grade_smooth</span>

<span class="sd">        :param activity_id: The ID of activity.</span>
<span class="sd">        :type activity_id: int</span>

<span class="sd">        :param types: (optional) A list of the the types of streams to fetch.</span>
<span class="sd">        :type types: list</span>

<span class="sd">        :param resolution: (optional, default is &#39;all&#39;) indicates desired number</span>
<span class="sd">                            of data points. &#39;low&#39; (100), &#39;medium&#39; (1000),</span>
<span class="sd">                            &#39;high&#39; (10000) or &#39;all&#39;.</span>
<span class="sd">        :type resolution: str</span>

<span class="sd">        :param series_type: (optional, default is &#39;distance&#39;.  Relevant only if</span>
<span class="sd">                             using resolution either &#39;time&#39; or &#39;distance&#39;.</span>
<span class="sd">                             Used to index the streams if the stream is being</span>
<span class="sd">                             reduced.</span>
<span class="sd">        :type series_type: str</span>

<span class="sd">        :return: An dictionary of :class:`stravalib.model.Stream` from the activity or None if there are no streams.</span>
<span class="sd">        :rtype: :py:class:`dict`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># stream are comma seperated list</span>
        <span class="k">if</span> <span class="n">types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">types</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">types</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">resolution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resolution</span>

        <span class="k">if</span> <span class="n">series_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;series_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">series_type</span>

        <span class="n">result_fetcher</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
                                           <span class="s1">&#39;/activities/</span><span class="si">{id}</span><span class="s1">/streams/</span><span class="si">{types}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">activity_id</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="n">types</span><span class="p">),</span>
                                           <span class="o">**</span><span class="n">params</span><span class="p">)</span>

        <span class="n">streams</span> <span class="o">=</span> <span class="n">BatchedResultsIterator</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">Stream</span><span class="p">,</span>
                                         <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="n">result_fetcher</span><span class="o">=</span><span class="n">result_fetcher</span><span class="p">)</span>

        <span class="c1"># Pack streams into dictionary</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">i</span><span class="o">.</span><span class="n">type</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">streams</span><span class="p">}</span>
        <span class="k">except</span> <span class="n">exc</span><span class="o">.</span><span class="n">ObjectNotFound</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># just to be explicit.</span></div>

<div class="viewcode-block" id="Client.get_effort_streams"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_effort_streams.html#stravalib.client.Client.get_effort_streams">[docs]</a>    <span class="k">def</span> <span class="nf">get_effort_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">effort_id</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">series_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an streams for an effort.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Streams-getSegmentEffortStreams</span>

<span class="sd">        Streams represent the raw data of the uploaded file. External</span>
<span class="sd">        applications may only access this information for activities owned</span>
<span class="sd">        by the authenticated athlete.</span>

<span class="sd">        Streams are available in 11 different types. If the stream is not</span>
<span class="sd">        available for a particular activity it will be left out of the request</span>
<span class="sd">        results.</span>

<span class="sd">        Streams types are: time, latlng, distance, altitude, velocity_smooth,</span>
<span class="sd">                           heartrate, cadence, watts, temp, moving, grade_smooth</span>

<span class="sd">        :param effort_id: The ID of effort.</span>
<span class="sd">        :type effort_id: int</span>

<span class="sd">        :param types: (optional) A list of the the types of streams to fetch.</span>
<span class="sd">        :type types: list</span>

<span class="sd">        :param resolution: (optional, default is &#39;all&#39;) indicates desired number</span>
<span class="sd">                            of data points. &#39;low&#39; (100), &#39;medium&#39; (1000),</span>
<span class="sd">                            &#39;high&#39; (10000) or &#39;all&#39;.</span>
<span class="sd">        :type resolution: str</span>

<span class="sd">        :param series_type: (optional, default is &#39;distance&#39;.  Relevant only if</span>
<span class="sd">                             using resolution either &#39;time&#39; or &#39;distance&#39;.</span>
<span class="sd">                             Used to index the streams if the stream is being</span>
<span class="sd">                             reduced.</span>
<span class="sd">        :type series_type: str</span>

<span class="sd">        :return: An dictionary of :class:`stravalib.model.Stream` from the effort.</span>
<span class="sd">        :rtype: :py:class:`dict`</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># stream are comma seperated list</span>
        <span class="k">if</span> <span class="n">types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">types</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">types</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">resolution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resolution</span>

        <span class="k">if</span> <span class="n">series_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;series_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">series_type</span>

        <span class="n">result_fetcher</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
                                           <span class="s1">&#39;/segment_efforts/</span><span class="si">{id}</span><span class="s1">/streams/</span><span class="si">{types}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">effort_id</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="n">types</span><span class="p">),</span>
                                           <span class="o">**</span><span class="n">params</span><span class="p">)</span>

        <span class="n">streams</span> <span class="o">=</span> <span class="n">BatchedResultsIterator</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">Stream</span><span class="p">,</span>
                                         <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="n">result_fetcher</span><span class="o">=</span><span class="n">result_fetcher</span><span class="p">)</span>

        <span class="c1"># Pack streams into dictionary</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">i</span><span class="o">.</span><span class="n">type</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">streams</span><span class="p">}</span></div>

<div class="viewcode-block" id="Client.get_segment_streams"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_segment_streams.html#stravalib.client.Client.get_segment_streams">[docs]</a>    <span class="k">def</span> <span class="nf">get_segment_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">segment_id</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">series_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an streams for a segment.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Streams-getSegmentStreams</span>

<span class="sd">        Streams represent the raw data of the uploaded file. External</span>
<span class="sd">        applications may only access this information for activities owned</span>
<span class="sd">        by the authenticated athlete.</span>

<span class="sd">        Streams are available in 11 different types. If the stream is not</span>
<span class="sd">        available for a particular activity it will be left out of the request</span>
<span class="sd">        results.</span>

<span class="sd">        Streams types are: time, latlng, distance, altitude, velocity_smooth,</span>
<span class="sd">                           heartrate, cadence, watts, temp, moving, grade_smooth</span>

<span class="sd">        :param segment_id: The ID of segment.</span>
<span class="sd">        :type segment_id: int</span>

<span class="sd">        :param types: (optional) A list of the the types of streams to fetch.</span>
<span class="sd">        :type types: list</span>

<span class="sd">        :param resolution: (optional, default is &#39;all&#39;) indicates desired number</span>
<span class="sd">                            of data points. &#39;low&#39; (100), &#39;medium&#39; (1000),</span>
<span class="sd">                            &#39;high&#39; (10000) or &#39;all&#39;.</span>
<span class="sd">        :type resolution: str</span>

<span class="sd">        :param series_type: (optional, default is &#39;distance&#39;.  Relevant only if</span>
<span class="sd">                             using resolution either &#39;time&#39; or &#39;distance&#39;.</span>
<span class="sd">                             Used to index the streams if the stream is being</span>
<span class="sd">                             reduced.</span>
<span class="sd">        :type series_type: str</span>

<span class="sd">        :return: An dictionary of :class:`stravalib.model.Stream` from the effort.</span>
<span class="sd">        :rtype: :py:class:`dict`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># stream are comma seperated list</span>
        <span class="k">if</span> <span class="n">types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">types</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">types</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">resolution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;resolution&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resolution</span>

        <span class="k">if</span> <span class="n">series_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;series_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">series_type</span>

        <span class="n">result_fetcher</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
                                           <span class="s1">&#39;/segments/</span><span class="si">{id}</span><span class="s1">/streams/</span><span class="si">{types}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">segment_id</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="n">types</span><span class="p">),</span>
                                           <span class="o">**</span><span class="n">params</span><span class="p">)</span>

        <span class="n">streams</span> <span class="o">=</span> <span class="n">BatchedResultsIterator</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">Stream</span><span class="p">,</span>
                                         <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="n">result_fetcher</span><span class="o">=</span><span class="n">result_fetcher</span><span class="p">)</span>

        <span class="c1"># Pack streams into dictionary</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">i</span><span class="o">.</span><span class="n">type</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">streams</span><span class="p">}</span></div>

<div class="viewcode-block" id="Client.get_running_race"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_running_race.html#stravalib.client.Client.get_running_race">[docs]</a>    <span class="k">def</span> <span class="nf">get_running_race</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">race_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets a running race for a given identifier.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-models-RunningRace</span>

<span class="sd">        :param race_id: id for the race</span>

<span class="sd">        :rtype: :class:`stravalib.model.RunningRace`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/running_races/</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">race_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">RunningRace</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="Client.get_running_races"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_running_races.html#stravalib.client.Client.get_running_races">[docs]</a>    <span class="k">def</span> <span class="nf">get_running_races</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets a running races for a given year.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-RunningRaces-getRunningRaces</span>

<span class="sd">        :param year: year for the races (default current)</span>

<span class="sd">        :return: An iterator of :class:`stravalib.model.RunningRace` objects.</span>
<span class="sd">        :rtype: :class:`BatchedResultsIterator`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">year</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">year</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="n">year</span><span class="p">}</span>

        <span class="n">result_fetcher</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
                                           <span class="s1">&#39;/running_races&#39;</span><span class="p">,</span>
                                           <span class="o">**</span><span class="n">params</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">BatchedResultsIterator</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">RunningRace</span><span class="p">,</span> <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="n">result_fetcher</span><span class="o">=</span><span class="n">result_fetcher</span><span class="p">)</span></div>


<div class="viewcode-block" id="Client.get_routes"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_routes.html#stravalib.client.Client.get_routes">[docs]</a>    <span class="k">def</span> <span class="nf">get_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">athlete_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the routes list for an authenticated user.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Routes-getRoutesByAthleteId</span>

<span class="sd">        :param athlete_id: id for the</span>

<span class="sd">        :param limit: Max rows to return (default unlimited).</span>
<span class="sd">        :type limit: int</span>

<span class="sd">        :return: An iterator of :class:`stravalib.model.Route` objects.</span>
<span class="sd">        :rtype: :class:`BatchedResultsIterator`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">athlete_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">athlete_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_athlete</span><span class="p">()</span><span class="o">.</span><span class="n">id</span>

        <span class="n">result_fetcher</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
                                           <span class="s1">&#39;/athletes/</span><span class="si">{id}</span><span class="s1">/routes&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">athlete_id</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">BatchedResultsIterator</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">Route</span><span class="p">,</span>
                                      <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="n">result_fetcher</span><span class="o">=</span><span class="n">result_fetcher</span><span class="p">,</span>
                                      <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.get_route"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_route.html#stravalib.client.Client.get_route">[docs]</a>    <span class="k">def</span> <span class="nf">get_route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">route_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets specified route.</span>

<span class="sd">        Will be detail-level if owned by authenticated user; otherwise summary-level.</span>

<span class="sd">        https://developers.strava.com/docs/reference/#api-Routes-getRouteById</span>

<span class="sd">        :param route_id: The ID of route to fetch.</span>
<span class="sd">        :type route_id: int</span>

<span class="sd">        :rtype: :class:`stravalib.model.Route`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/routes/</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">route_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">Route</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.get_route_streams"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.get_route_streams.html#stravalib.client.Client.get_route_streams">[docs]</a>    <span class="k">def</span> <span class="nf">get_route_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">route_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns streams for a route.</span>

<span class="sd">        Streams represent the raw data of the saved route. External</span>
<span class="sd">        applications may access this information for all public routes and for</span>
<span class="sd">        the private routes of the authenticated athlete. The 3 available route</span>
<span class="sd">        stream types `distance`, `altitude` and `latlng` are always returned.</span>

<span class="sd">        See: https://developers.strava.com/docs/reference/#api-Streams-getRouteStreams</span>

<span class="sd">        :param route_id: The ID of activity.</span>
<span class="sd">        :type route_id: int</span>

<span class="sd">        :return: A dictionary of :class:`stravalib.model.Stream` from the route.</span>
<span class="sd">        :rtype: :py:class:`dict`</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">result_fetcher</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
                                           <span class="s1">&#39;/routes/</span><span class="si">{id}</span><span class="s1">/streams/&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">route_id</span><span class="p">))</span>

        <span class="n">streams</span> <span class="o">=</span> <span class="n">BatchedResultsIterator</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">Stream</span><span class="p">,</span>
                                         <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="n">result_fetcher</span><span class="o">=</span><span class="n">result_fetcher</span><span class="p">)</span>

        <span class="c1"># Pack streams into dictionary</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">i</span><span class="o">.</span><span class="n">type</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">streams</span><span class="p">}</span></div>

    <span class="c1"># TODO: removed old link to create a subscription but can&#39;t find new equiv</span>
    <span class="c1"># in current strava docs</span>
<div class="viewcode-block" id="Client.create_subscription"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.create_subscription.html#stravalib.client.Client.create_subscription">[docs]</a>    <span class="k">def</span> <span class="nf">create_subscription</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">,</span> <span class="n">callback_url</span><span class="p">,</span>
                            <span class="n">verify_token</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">VERIFY_TOKEN_DEFAULT</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a webhook event subscription.</span>

<span class="sd">        :param client_id: application&#39;s ID, obtained during registration</span>
<span class="sd">        :type client_id: int</span>

<span class="sd">        :param client_secret: application&#39;s secret, obtained during registration</span>
<span class="sd">        :type client_secret: str</span>

<span class="sd">        :param callback_url: callback URL where Strava will first send a GET request to validate, then subsequently send POST requests with updates</span>
<span class="sd">        :type callback_url: str</span>

<span class="sd">        :param verify_token: a token you can use to verify Strava&#39;s GET callback request</span>
<span class="sd">        :type verify_token: str</span>

<span class="sd">        :return: An instance of :class:`stravalib.model.Subscription`.</span>
<span class="sd">        :rtype: :class:`stravalib.model.Subscription`</span>

<span class="sd">        Notes:</span>

<span class="sd">        `verify_token` is set to a default in the event that the author doesn&#39;t want to specify one.</span>

<span class="sd">        The appliction must have permission to make use of the webhook API. Access can be requested by contacting developers -at- strava.com.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
                      <span class="n">callback_url</span><span class="o">=</span><span class="n">callback_url</span><span class="p">,</span> <span class="n">verify_token</span><span class="o">=</span><span class="n">verify_token</span><span class="p">)</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/push_subscriptions&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Client.handle_subscription_callback"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.handle_subscription_callback.html#stravalib.client.Client.handle_subscription_callback">[docs]</a>    <span class="k">def</span> <span class="nf">handle_subscription_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw</span><span class="p">,</span>
                                     <span class="n">verify_token</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">Subscription</span><span class="o">.</span><span class="n">VERIFY_TOKEN_DEFAULT</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate callback request and return valid response with challenge.</span>

<span class="sd">        :return: The JSON response expected by Strava to the challenge request.</span>
<span class="sd">        :rtype: Dict[str, str]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">callback</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">SubscriptionCallback</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
        <span class="n">callback</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">verify_token</span><span class="p">)</span>
        <span class="n">response_raw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;hub.challenge&#39;</span><span class="p">:</span> <span class="n">callback</span><span class="o">.</span><span class="n">hub_challenge</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">response_raw</span></div>

<div class="viewcode-block" id="Client.handle_subscription_update"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.handle_subscription_update.html#stravalib.client.Client.handle_subscription_update">[docs]</a>    <span class="k">def</span> <span class="nf">handle_subscription_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a raw subscription update into a model.</span>

<span class="sd">        :return: The subscription update model object.</span>
<span class="sd">        :rtype: :class:`stravalib.model.SubscriptionUpdate`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">SubscriptionUpdate</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="c1"># TODO can&#39;t find a api doc link here so just removed old link.</span>
<div class="viewcode-block" id="Client.list_subscriptions"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.list_subscriptions.html#stravalib.client.Client.list_subscriptions">[docs]</a>    <span class="k">def</span> <span class="nf">list_subscriptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List current webhook event subscriptions in place for the current application.</span>

<span class="sd">        :param client_id: application&#39;s ID, obtained during registration</span>
<span class="sd">        :type client_id: int</span>

<span class="sd">        :param client_secret: application&#39;s secret, obtained during registration</span>
<span class="sd">        :type client_secret: str</span>

<span class="sd">        :return: An iterator of :class:`stravalib.model.Subscription` objects.</span>
<span class="sd">        :rtype: :class:`BatchedResultsIterator`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result_fetcher</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="s1">&#39;/push_subscriptions&#39;</span><span class="p">,</span> <span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
                                           <span class="n">client_secret</span><span class="o">=</span><span class="n">client_secret</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">BatchedResultsIterator</span><span class="p">(</span><span class="n">entity</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">Subscription</span><span class="p">,</span>
                                      <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="n">result_fetcher</span><span class="o">=</span><span class="n">result_fetcher</span><span class="p">)</span></div>

    <span class="c1"># TODO can&#39;t find a api doc link here so just removed old link.</span>
<div class="viewcode-block" id="Client.delete_subscription"><a class="viewcode-back" href="../../reference/api/stravalib.client.Client.delete_subscription.html#stravalib.client.Client.delete_subscription">[docs]</a>    <span class="k">def</span> <span class="nf">delete_subscription</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subscription_id</span><span class="p">,</span> <span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unsubscribe from webhook events for an existing subscription.</span>

<span class="sd">        :param subscription_id: ID of subscription to remove.</span>
<span class="sd">        :type subscription_id: int</span>

<span class="sd">        :param client_id: application&#39;s ID, obtained during registration</span>
<span class="sd">        :type client_id: int</span>

<span class="sd">        :param client_secret: application&#39;s secret, obtained during registration</span>
<span class="sd">        :type client_secret: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;/push_subscriptions/</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">subscription_id</span><span class="p">,</span>
                             <span class="n">client_id</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="o">=</span><span class="n">client_secret</span><span class="p">)</span></div></div>
        <span class="c1"># Expects a 204 response if all goes well.</span>


<span class="k">class</span> <span class="nc">BatchedResultsIterator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An iterator that enables iterating over requests that return paged results.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># How many results returned in a batch.  We maximize this to minimize</span>
    <span class="c1">#  requests to server (rate limiting)</span>
    <span class="n">default_per_page</span> <span class="o">=</span> <span class="mi">200</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">,</span> <span class="n">result_fetcher</span><span class="p">,</span> <span class="n">bind_client</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">per_page</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param entity: The class for the model entity.</span>
<span class="sd">        :type entity: type</span>

<span class="sd">        :param result_fetcher: The callable that will return another batch of results.</span>
<span class="sd">        :type result_fetcher: callable</span>

<span class="sd">        :param bind_client: The client object to pass to the entities for supporting further</span>
<span class="sd">                             fetching of objects.</span>
<span class="sd">        :type bind_client: :class:`stravalib.client.Client`</span>

<span class="sd">        :param limit: The maximum number of rides to return.</span>
<span class="sd">        :type limit: int</span>

<span class="sd">        :param per_page: How many rows to fetch per page (default is 200).</span>
<span class="sd">        :type per_page: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{0.__module__}</span><span class="s1">.</span><span class="si">{0.__name__}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entity</span> <span class="o">=</span> <span class="n">entity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bind_client</span> <span class="o">=</span> <span class="n">bind_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_fetcher</span> <span class="o">=</span> <span class="n">result_fetcher</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limit</span> <span class="o">=</span> <span class="n">limit</span>

        <span class="k">if</span> <span class="n">per_page</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">per_page</span> <span class="o">=</span> <span class="n">per_page</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">per_page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_per_page</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">{0}</span><span class="s1"> entity=</span><span class="si">{1}</span><span class="s1">&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_page</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_results_fetched</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_fill_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fills the internal size-50 buffer from Strava API.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If we cannot fetch anymore from the server then we&#39;re done here.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_results_fetched</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eof</span><span class="p">()</span>

        <span class="n">raw_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_fetcher</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_page</span><span class="p">,</span> <span class="n">per_page</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">per_page</span><span class="p">)</span>

        <span class="n">entities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">raw</span> <span class="ow">in</span> <span class="n">raw_results</span><span class="p">:</span>
            <span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entity</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">bind_client</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bind_client</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Requested page </span><span class="si">{0}</span><span class="s2"> (got: </span><span class="si">{1}</span><span class="s2"> items)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_page</span><span class="p">,</span>
                                                                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_page</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_all_results_fetched</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_page</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_eof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">StopIteration</span>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counter</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eof</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fill_buffer</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_eof</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">result</span>


<div class="viewcode-block" id="ActivityUploader"><a class="viewcode-back" href="../../reference/api/stravalib.client.ActivityUploader.html#stravalib.client.ActivityUploader">[docs]</a><span class="k">class</span> <span class="nc">ActivityUploader</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The &quot;future&quot; object that holds information about an activity file upload and can</span>
<span class="sd">    wait for upload to finish, etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ActivityUploader.__init__"><a class="viewcode-back" href="../../reference/api/stravalib.client.ActivityUploader.html#stravalib.client.ActivityUploader.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">raise_exc</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param client: The :class:`stravalib.client.Client` object that is handling the upload.</span>
<span class="sd">        :type client: :class:`stravalib.client.Client`</span>

<span class="sd">        :param response: The initial upload response.</span>
<span class="sd">        :type response: Dict[str,Any]</span>

<span class="sd">        :param raise_exc: Whether to raise an exception if the response</span>
<span class="sd">                  indicates an error state. (default True)</span>
<span class="sd">        :type raise_exc: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">response</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_from_response</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">raise_exc</span><span class="o">=</span><span class="n">raise_exc</span><span class="p">)</span></div>

<div class="viewcode-block" id="ActivityUploader.update_from_response"><a class="viewcode-back" href="../../reference/api/stravalib.client.ActivityUploader.update_from_response.html#stravalib.client.ActivityUploader.update_from_response">[docs]</a>    <span class="k">def</span> <span class="nf">update_from_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">raise_exc</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates internal state of object.</span>

<span class="sd">        :param response: The response object (dict).</span>
<span class="sd">        :type response: :py:class:`dict`</span>
<span class="sd">        :param raise_exc: Whether to raise an exception if the response</span>
<span class="sd">                          indicates an error state. (default True)</span>
<span class="sd">        :type raise_exc: bool</span>
<span class="sd">        :raise stravalib.exc.ActivityUploadFailed: If the response indicates an error and raise_exc is True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upload_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">external_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;external_id&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activity_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;activity_id&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;errors&#39;</span><span class="p">):</span>
            <span class="c1"># This appears to be an undocumented API; ths is a bit of a hack for now.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;errors&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">raise_exc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_for_error</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">activity_id</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">activity_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">raise_for_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># FIXME: We need better handling of the actual responses, once those are more accurately documented.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">ActivityUploadFailed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;The created activity has been deleted.&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">CreatedActivityDeleted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">poll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update internal state from polling strava.com.</span>

<span class="sd">        :raise stravalib.exc.ActivityUploadFailed: If the poll returns an error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/uploads/</span><span class="si">{upload_id}</span><span class="s1">&#39;</span><span class="p">,</span>
                                            <span class="n">upload_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">upload_id</span><span class="p">,</span>
                                            <span class="n">check_for_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_from_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">poll_interval</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wait for the upload to complete or to err out.</span>

<span class="sd">        Will return the resulting Activity or raise an exception if the upload fails.</span>

<span class="sd">        :param timeout: The max seconds to wait. Will raise TimeoutExceeded</span>
<span class="sd">                        exception if this time passes without success or error response.</span>
<span class="sd">        :type timeout: float</span>

<span class="sd">        :param poll_interval: How long to wait between upload checks.  Strava</span>
<span class="sd">                              recommends 1s minimum. (default 1.0s)</span>
<span class="sd">        :type poll_interval: float</span>

<span class="sd">        :return: The uploaded Activity object (fetched from server)</span>
<span class="sd">        :rtype: :class:`stravalib.model.Activity`</span>

<span class="sd">        :raise stravalib.exc.TimeoutExceeded: If a timeout was specified and</span>
<span class="sd">                                              activity is still processing after</span>
<span class="sd">                                              timeout has elapsed.</span>
<span class="sd">        :raise stravalib.exc.ActivityUploadFailed: If the poll returns an error.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">activity_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">poll_interval</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">timeout</span> <span class="ow">and</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">exc</span><span class="o">.</span><span class="n">TimeoutExceeded</span><span class="p">()</span>
        <span class="c1"># If we got this far, we must have an activity!</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get_activity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">activity_id</span><span class="p">)</span></div>
</pre></div>

              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, Hans Lellelid.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.2.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>