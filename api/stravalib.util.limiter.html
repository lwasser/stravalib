
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Utilities &#8212; stravalib 0.6.0 documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Attributes" href="stravalib.attributes.html" />
    <link rel="prev" title="stravalib.util package" href="stravalib.util.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../index.html">
<p class="title">stravalib</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../index.html">
  Home
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../get-started/index.html">
  Get Started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../contributing.html">
  Contributing
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../changelog.html">
  Change Log
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="stravalib.html">
  API Reference
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="stravalib.util.html">
   stravalib.util package
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Utilities
    </a>
   </li>
  </ul>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="stravalib.attributes.html">
   Attributes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stravalib.client.html">
   Client
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stravalib.exc.html">
   Exc
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stravalib.model.html">
   Client
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stravalib.protocol.html">
   Protocol
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stravalib.unithelper.html">
   Unit Helper
  </a>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                

<nav id="bd-toc-nav">
    
</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <span class="target" id="module-stravalib.util.limiter"></span><div class="section" id="utilities">
<h1>Utilities<a class="headerlink" href="#utilities" title="Permalink to this headline">¶</a></h1>
<p>Rate limiter classes.</p>
<p>These are basically callables that when called register that a request was
issued.  Depending on how they are configured that may cause a pause or exception
if a rate limit has been exceeded.  Obviously it is up to the calling code to ensure
that these callables are invoked with every (successful?) call to the backend
API.  (There is probably a better way to hook these into the requests library
directly … TBD.)</p>
<dl>
<dt>From the Strava docs:</dt><dd><p>Strava API usage is limited on a per-application basis using a short term,
15 minute, limit and a long term, daily, limit. The default rate limit allows
600 requests every 15 minutes, with up to 30,000 requests per day.</p>
<p>This limit allows applications to make 40 requests per minute for about
half the day.</p>
</dd>
</dl>
<dl class="py function">
<dt class="sig sig-object py" id="stravalib.util.limiter.total_seconds">
<span class="sig-prename descclassname"><span class="pre">stravalib.util.limiter.</span></span><span class="sig-name descname"><span class="pre">total_seconds</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">td</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/stravalib/util/limiter.html#total_seconds"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#stravalib.util.limiter.total_seconds" title="Permalink to this definition">¶</a></dt>
<dd><p>Alternative to datetime.timedelta.total_seconds
total_seconds() only available since Python 2.7
<a class="reference external" href="https://docs.python.org/2/library/datetime.html#datetime.timedelta.total_seconds">https://docs.python.org/2/library/datetime.html#datetime.timedelta.total_seconds</a></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stravalib.util.limiter.RequestRate">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stravalib.util.limiter.</span></span><span class="sig-name descname"><span class="pre">RequestRate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">short_usage</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">long_usage</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">short_limit</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">long_limit</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#stravalib.util.limiter.RequestRate" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="stravalib.util.limiter.RequestRate.long_limit">
<span class="sig-name descname"><span class="pre">long_limit</span></span><a class="headerlink" href="#stravalib.util.limiter.RequestRate.long_limit" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 3</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="stravalib.util.limiter.RequestRate.long_usage">
<span class="sig-name descname"><span class="pre">long_usage</span></span><a class="headerlink" href="#stravalib.util.limiter.RequestRate.long_usage" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="stravalib.util.limiter.RequestRate.short_limit">
<span class="sig-name descname"><span class="pre">short_limit</span></span><a class="headerlink" href="#stravalib.util.limiter.RequestRate.short_limit" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 2</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="stravalib.util.limiter.RequestRate.short_usage">
<span class="sig-name descname"><span class="pre">short_usage</span></span><a class="headerlink" href="#stravalib.util.limiter.RequestRate.short_usage" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="stravalib.util.limiter.get_rates_from_response_headers">
<span class="sig-prename descclassname"><span class="pre">stravalib.util.limiter.</span></span><span class="sig-name descname"><span class="pre">get_rates_from_response_headers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">headers</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/stravalib/util/limiter.html#get_rates_from_response_headers"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#stravalib.util.limiter.get_rates_from_response_headers" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a namedtuple with values for short - and long usage and limit rates found in provided HTTP response headers
:param headers: HTTP response headers
:type headers: dict
:return: namedtuple with request rates or None if no rate-limit headers present in response.
:rtype: Optional[RequestRate]</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="stravalib.util.limiter.get_seconds_until_next_quarter">
<span class="sig-prename descclassname"><span class="pre">stravalib.util.limiter.</span></span><span class="sig-name descname"><span class="pre">get_seconds_until_next_quarter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">now</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/stravalib/util/limiter.html#get_seconds_until_next_quarter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#stravalib.util.limiter.get_seconds_until_next_quarter" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the number of seconds until the next quarter of an hour. This is the short-term rate limit used by Strava.
:param now: A (utc) timestamp
:type now: arrow.arrow.Arrow
:return: the number of seconds until the next quarter, as int</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="stravalib.util.limiter.get_seconds_until_next_day">
<span class="sig-prename descclassname"><span class="pre">stravalib.util.limiter.</span></span><span class="sig-name descname"><span class="pre">get_seconds_until_next_day</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">now</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/stravalib/util/limiter.html#get_seconds_until_next_day"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#stravalib.util.limiter.get_seconds_until_next_day" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the number of seconds until the next day (utc midnight). This is the long-term rate limit used by Strava.
:param now: A (utc) timestamp
:type now: arrow.arrow.Arrow
:return: the number of seconds until next day, as int</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stravalib.util.limiter.XRateLimitRule">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stravalib.util.limiter.</span></span><span class="sig-name descname"><span class="pre">XRateLimitRule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">limits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_limits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/stravalib/util/limiter.html#XRateLimitRule"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#stravalib.util.limiter.XRateLimitRule" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<dl class="py property">
<dt class="sig sig-object py" id="stravalib.util.limiter.XRateLimitRule.limit_timeout">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">limit_timeout</span></span><a class="headerlink" href="#stravalib.util.limiter.XRateLimitRule.limit_timeout" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stravalib.util.limiter.SleepingRateLimitRule">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stravalib.util.limiter.</span></span><span class="sig-name descname"><span class="pre">SleepingRateLimitRule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">priority</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'high'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">short_limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">long_limit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_limits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/stravalib/util/limiter.html#SleepingRateLimitRule"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#stravalib.util.limiter.SleepingRateLimitRule" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>A rate limit rule that can be prioritized and can dynamically adapt its limits based on API responses.
Given its priority, it will enforce a variable “cool-down” period after each response. When rate limits
are reached within their period, this limiter will wait until the end of that period. It will NOT raise
any kind of exception in this case.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stravalib.util.limiter.RateLimitRule">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stravalib.util.limiter.</span></span><span class="sig-name descname"><span class="pre">RateLimitRule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">requests</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seconds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raise_exc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/stravalib/util/limiter.html#RateLimitRule"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#stravalib.util.limiter.RateLimitRule" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stravalib.util.limiter.RateLimiter">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stravalib.util.limiter.</span></span><span class="sig-name descname"><span class="pre">RateLimiter</span></span><a class="reference internal" href="../_modules/stravalib/util/limiter.html#RateLimiter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#stravalib.util.limiter.RateLimiter" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="stravalib.util.limiter.DefaultRateLimiter">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">stravalib.util.limiter.</span></span><span class="sig-name descname"><span class="pre">DefaultRateLimiter</span></span><a class="reference internal" href="../_modules/stravalib/util/limiter.html#DefaultRateLimiter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#stravalib.util.limiter.DefaultRateLimiter" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#stravalib.util.limiter.RateLimiter" title="stravalib.util.limiter.RateLimiter"><code class="xref py py-class docutils literal notranslate"><span class="pre">stravalib.util.limiter.RateLimiter</span></code></a></p>
<p>Implements something similar to the default rate limit for Strava apps.</p>
<p>To do this correctly we would actually need to change our logic to reset
the limit at midnight, etc.  Will make this more complex in the future.</p>
<p>Strava API usage is limited on a per-application basis using a short term,
15 minute, limit and a long term, daily, limit. The default rate limit allows
600 requests every 15 minutes, with up to 30,000 requests per day.</p>
</dd></dl>

</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="stravalib.util.html" title="previous page">stravalib.util package</a>
    <a class='right-next' id="next-link" href="stravalib.attributes.html" title="next page">Attributes</a>

              </div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, Hans Lellelid.<br/>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.2.0.<br/>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>